<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "../default.css">
  <head>
    <body>
      <h1>PEDを用いたイネの多型解析例</h1>
      <a href = "../index_ja.html">[日本語トップページへのリンク]</a><br><br>
      <table>
      <tr>
      <td>
      <ul>
      <li>図をクリックすると説明にジャンプします。<font color = "red"><b>NEW</b></font><br>
      <a href = "jrc_wrc.html" target = "_blank"><img src = "ago1d.png" height = "200px"></a>
      <li>イネのコアコレクションの多型一覧です。
      <li>変異を持っている系統との交配で<font color = "red"><b>変異を導入</b></font>することができます。
      </ul>
      </td>
      <td>
      <ul>
      <li>図をクリックすると拡大されます。<br>
      <a href = "DRR099981.png" target = "_blank"><img src = "DRR099981.png" height = "200px"></a>
      <li>SNP以外に、挿入・欠失変異も正確に検出できる特徴があります。
      <li>変異部分を増幅するプライマー対の配列も得られます。
      </ul>
      </td>
      <td>
      <ul>
      <li>図をクリックすると説明にジャンプします。<br>
      <a href = "#sbl" target = "_blank"><img src = "nics.png" height = "200px"></a>
      <li>コシヒカリSBLが持つ、イネ縞葉枯れ病抵抗性遺伝子領域(Stvb-i)にある欠失変異の一覧です。
      <li>コシヒカリSBL(赤)でのみ、対象領域に多型が検出されています。
      <li>変異部分を増幅するプライマー対の配列も得られます。
      </ul>
      </td>
      </table>

      <h2>Ubuntuのインストール</h2>
      <ul>
      <li><a href = "https://www.ubuntulinux.jp/download/ja-remix" target = "_blank">Ubuntu Desktop 日本語 Remix</a>より日本語版のISOイメージのファイルをダウンロードします。
      <li><a href = "https://linuxfan.info/ubuntu-20-04-install-guide" target = "_blank">Ubuntu 20.04 LTSインストールガイド【スクリーンショットつき解説】</a>が詳しいので参考にしてインストールしてください。<br>
      PEDは解析時間をできるだけ短くするため、CPUの限界近くまで負荷がかかりますのでほかのOSとの共存は避けた方がいいです。<br>
使わなくなった古いコンピュータなどにインストールして専用にするのがお勧めです。<br>
マルチスレッドで動作しますので、4あるいは8コアのCPUを用いると早く処理できます。
      </ul>
      <h2>PEDのセットアップと解析例</h2>
      <ul>
      <li>必要なソフトをダウンロードとインストールを行います。
      <pre>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install curl
$ sudo apt install git
$ sudo apt install sra-toolkit
$ git clone https://github.com/akiomiyao/ped.git</pre>
      <li>Ubuntuのバージョンによっては、sra-toolkitのインストールに失敗することがあります。<br>
また最近のバージョンのfastq-dumpは使用前にvdb-configコマンドで実行環境を設定する必要があります。<br>
設定方法は、<a href = "../sratoolkit/index_ja.html" target = "_blank">[fastq-dumpの設定]</a>のページに記載しました。
      <li>NCBIのSRAアーカイブからコシヒカリのfastq形式のファイル(DRR099981)をダウンロードします。
      <pre>$ cd ped
$ git pull
$ perl download.pl accession=DRR099981</pre>
git pullで最新のスクリプトに更新されます。git pullは毎回行う必要はありませんが、プログラムが更新されている場合はpullしてください。<br>
pedのディレクトリの中に、DRR099981の名称のディレクトリができて、その中のreadというディレクトリの中にfastqファイルがダウンロードされます。<br>
アメリカからのダウンロードなので時間がかかります。<br>
時々エラーが表示されますが自動的に再接続されるので、気長に待ちます。<br>
同様の構造の任意の名前のディレクトリを作れば手持ちのデータの解析ができます。<br>
      <li>DRR099981の配列をイネの参照配列IRGSP1.0にマップして多型を検出します。
<pre>$ perl ped.pl target=DRR099981,ref=IRGSP1.0</pre>
イネの参照配列は設定済みなので自動的にダウンロードして解析用データを作成して一連の作業が自動的に進みます。<br>
解析が無事終わるとDRR099981のディレクトリの中に、DRR099981.vcfという結果をまとめたファイルができます。<br>
各座位に対してプライマーが作成可能な場合は、プライマーペアの配列データも出力されます。
      </ul>
      <h2>Dockerでの解析</h2>
      <ul>
      <li>Dockerを用いれば、必要な時に設定済み実行環境を取り込んで解析できます。<br>
      グーグルクラウド(GCP)やアマゾンウェブサービス(AWS)などのクラウドでの実行も可能です。
      <li>Dockerのセットアップ<br>
      $ sudo apt install docker<br>
      $ sudo apt install docker.io<br>
      <li>解析例<br>
      $ sudo docker pull akiomiyao/ped<br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl download.pl accession=DRR099981,wd=/work <br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl ped.pl target=DRR099981,ref=IRGSP1.0,wd=/work <br>
      上記のコマンドをコピーしてターミナルウインドウにペーストして実行してください。
      </ul>
      <h2>IVGブラウザによる結果の確認</h2>
      <ul>
      <li>Integrative Genomics Viewer (IVG) はBroad Instituteで作成されたゲノムブラウザです。<br>
<a href = "https://igv.org/app/" target = "_blank">IGV Web App</a>が便利です。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/IRGSP1.0.fasta" target = "_blank">IRGSP1.0.fasta</a>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/IRGSP1.0.fasta.fai" target = "_blank">IRGSP1.0.fasta.fai</a>をダウンロードします。<br>
Genomesのプルダウンメニューより'Local File ...'を選んで、IRGSP1.0.fastaとIRGSP1.0.fasta.faiの両方を同時に選んでロードします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/transcripts.gff" target = "_blank">transcripts.gff</a>をダウンロードして、
Tracksのプルダウンメニューより'Local File ...'を選んでロードします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/DRR099981.vcf" target = "_blank">DRR099981.vcf</a>をダウンロードして、
Tracksのプルダウンメニューより'Local File ...'を選んでロードします。<br>
個別の染色体を選んで拡大していくと多型が表示されます。<br>
fastaの右端にある設定ボタンより、Three-frame Translateを選ぶとアミノ酸配列が表示されます。Reverseを選ぶと相補鎖側の配列が表示されます。
<li>デスクトップ版は、<a href = "http://software.broadinstitute.org/software/igv/download" target = "_blank">http://software.broadinstitute.org/software/igv/download</a> からダウンロードできます。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/IRGSP1.0.fasta" target = "_blank">IRGSP1.0.fasta</a>をダウンロードします。<br>
IVGを開いてGenomesのプルダウンメニューよりLoad Genome from Fileを選んで、IRGSP1.0.fastaを選んでロードします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/locus.gff" target = "_blank">locus.gff</a><br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/transcripts.gff" target = "_blank">transcripts.gff</a><br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/transcripts_exon.gff" target = "_blank">transcripts_exon.gff</a><br>
をダウンロードして、メインの表示ボックスの下のサブのボックスにドラッグします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200501CWSA/DRR099981.vcf" target = "_blank">DRR099981.vcf</a><br>
をメインの表示ボックスにドラッグすれば、コシヒカリの多型データが取り込まれます。<br>
各染色体の番号をクリックすると、染色体ごとの多型情報が表示されます。<br>
興味のある部分をクリックすると、どんどん拡大されます。<br>
多型をマウスで指すと詳細情報が表示されます。<br>
多型の種類や多型頻度、また、プライマー対の配列情報と増幅産物のサイズも表示されます。<br>
ページのトップの<a href = "DRR099981.png" target = "_blank">画像</a>が表示例です。クリックすると大きくなります。<br>
多型の部分を増幅するプライマー配列も表示されます。至適配列が見つからない部位では表示されません。
      <li><b>注意点</b> IVGでは長い欠失や転座の情報をうまく表示できない場合があるので、転座と80塩基以上の欠失に関しては、vcfファイルに出力しないように設定しています。<br>
大きな構造変異を調べたい場合は、targetのディレクトリの中に出力された、svの拡張子のついたファイルを直接ご参照ください。

      </ul>
      <h2><a name = "sbl">コシヒカリ類縁品種の多型の比較</a></h2>
コシヒカリの遺伝的背景を持つ品種のNGS配列を比較してみました。<br>
配列データは<a href = "https://www.ncbi.nlm.nih.gov/Traces/study/?acc=DRP004128&o=acc_s%3Aa" target = "_blank">NCBI の SRA DRP004128</a>より取得可能です。<br>
<pre>$ cd ped
$ perl download.pl accession=DRR099981</pre>
のようにして、順に配列データをダウンロードします。<br>
ダウンロード後、ディレクトリ名を
<pre>$ mv DRR099981 koshihikari
</pre>のように品種名に変えておくとわかりやすくなります。
<pre>$ perl ped.pl target=koshihikari,ref=IRGSP1.0
</pre>のようにして品種ごとに順に解析します。<br>
次に、各品種の多型を整理した表を作ります。
<pre>$ perl compare.pl target=genkitsukushi:hinohikari:hitomebore:hoshinoyume:koshihikari:koshihikari_sbl1:nipponbare:tenkomori:tentakaku > snp.txt
$ perl compare.pl target=genkitsukushi:hinohikari:hitomebore:hoshinoyume:koshihikari:koshihikari_sbl1:nipponbare:tenkomori:tentakaku,type=sv > sv.txt
</pre>
タブ区切りテキストファイルなので、エクセルで開くことができます。<br>
構造変異のファイル(sv.txt)をエクセルにとりこんで、欠失に絞り込んで表示してみました。<br>
1塩基、2塩基の欠失は体細胞変異の場合が多いので、19塩基までの欠失と100,000塩基以上の欠失、およびヘテロの欠失は除外しました。<br>
<a href = "nics.png" target = "_blank"><img src = "nics.png" height = "200px"></a>クリックすると拡大図が表示されます。<br>
コシヒカリSBL1はコシヒカリに縞葉枯れ病耐性の遺伝子を導入された品種ですが、コシヒカリSBL1の変異に絞り込んで(赤)表示させると、<br>
第11染色体のStvb-i遺伝子(オレンジのあたり)の領域にコシヒカリSBL1特異的な欠失変異が存在することがわかります。<br>
Stvb-i遺伝子については、<br>
<a href = "https://doi.org/10.3389/fpls.2020.00519" target = "_blank">Hayano-Saito Y and Hayashi K (2020) Stvb-i, a Rice Gene Conferring Durable Resistance to Rice stripe virus, Protects Plant Growth From Heat Stress. Front. Plant Sci. 11:519.</a><br>
をご覧ください。
      <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
      </ul> 
      <h2>お問い合わせ</h2>
農研機構<br>
宮尾安藝雄 (miyao@affrc.go.jp)<br>
    </body>
</html>
