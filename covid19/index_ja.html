<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "../default.css">
  </head>
  <body>
    <h1>PEDを用いたSARS-CoV-2 (COVID-19)の変異検出</h1>
    <a href = "../index_ja.html">[日本語トップページへのリンク]</a><br><br>
    NCBI（米国立バイオテクノロジー情報センター）で塩基配列情報が公開させていますが、COVID-19に感染した患者から得られたウイルスの配列も公開されています。<br>
    例 <a href = "https://www.ncbi.nlm.nih.gov/Traces/study/?acc=ERP121228&f=platform_s%3An%3Aillumina%3Ac&o=acc_s%3Aa" target = "_blank">[イギリスの患者の配列のリンク]</a>
    <ul>
    <li>配列をPEDで解析すると以下の図のように患者から得られたウイルスのゲノム上に起きた変異を見ることができます。図をクリックすると大きくなります。<br>
    <a href = "SARS-CoV-2.png" target = "_blank"><img src = "SARS-CoV-2.png" width = "30%"></a>
    <li>23kbのあたりのスパイクタンパク質をコードしているs遺伝子のsの文字の下あたりにある赤い縦線が23403の塩基位置のA→Gの塩基置換変異でアスパラギン酸からグリシンへのD614G変異となります。<br>
    この場合、5人中3人がこの変異を持っていることになります。<br>
    最近では、大部分の人からのウイルスがこの変異を持っています。<br>
    おそらくこの変異を持っている方が、ヒト側の受容体タンパクのアンギオテンシン変換酵素2(ACE2)に結合しやすいのではないかと思われます。
    </ul>
    <h2>Ubuntuのインストール</h2>
解析にはLinux(Unix)のインストールされたコンピュータが必要です。以下は、Linux(Ubuntu)のインストールの手引きです。
      <ul>
      <li><a href = "https://www.ubuntulinux.jp/download/ja-remix" target = "_blank">Ubuntu Desktop 日本語 Remix</a>より日本語版のISOイメージのファイルをダウンロードします。
      <li><a href = "https://linuxfan.info/ubuntu-20-04-install-guide" target = "_blank">Ubuntu 20.04 LTSインストールガイド【スクリーンショットつき解説】</a>が詳しいので参考にしてインストールしてください。<br>
      PEDは解析時間をできるだけ短くするため、CPUの限界近くまで負荷がかかりますのでほかのOSとの共存は避けた方がいいです。<br>
使わなくなった古いコンピュータなどにインストールして専用にするのがお勧めです。<br>
マルチスレッドで動作しますので、4あるいは8コアのCPUを用いると早く処理できます。<br>
<a href = "../virtualbox/index.html" target = "_blank">VirtualBoxを用いてWindowsマシンで解析する方法</a>や、<a href = "../aws/index.html" target = "_blank">クラウドで実行する方法</a>もあります。
      </ul>
      <h2>PEDのセットアップと解析例</h2>
      <ul>
      <li>必要なソフトをダウンロードとインストールを行います。
      <pre>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install curl
$ sudo apt install git
$ sudo apt install sra-toolkit
$ git clone https://github.com/akiomiyao/ped.git</pre>
      <li>Ubuntuのバージョンによっては、sra-toolkitのインストールに失敗することがあります。<br>
その場合は、 <a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software" target = "_blank">https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software</a>からUbuntu Linux 64 bit architectureのToolkitをダウンロードします。<br>
      <pre>$ tar xvfz sratoolkit.2.x.x-ubuntu64.tar.gz
$ cd sratoolkit.2.x.x-ubuntu64/bin
$ sudo mv fastq-dump-orig.2.x.x /usr/local/bin/fastq-dump</pre>
      tar コマンドで展開したfastq-dumpを/usr/local/binに移せば大丈夫です。-orig以下の名前は削って、fastq-dumpという名称にして移します。<br>
  

    <li>NCBI sequence read archive (SRA)から各患者から得られた配列をダウンロードします。<br>
    $ cd ped<br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11513115" target = "_blank">SRR11513115</a><br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11513116" target = "_blank">SRR11513116</a><br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11513117" target = "_blank">SRR11513117</a><br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11513118" target = "_blank">SRR11513118</a><br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11542243" target = "_blank">SRR11542243</a><br>
    $ perl download.pl accession=<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=SRR11542244" target = "_blank">SRR11542244</a><br>
    <li>配列は長さが不ぞろいなので、配列長の分布を調べて一定長にそろえる(clipping)ための値を決めます。最大長より数塩基短い値にします。<br>
    $ perl check_length.pl target=SRR11513115<br>
    $ perl check_length.pl target=SRR11513116<br>
    $ perl check_length.pl target=SRR11513117<br>
    $ perl check_length.pl target=SRR11513118<br>
    $ perl check_length.pl target=SRR11542243<br>
    $ perl check_length.pl target=SRR11542244<br>

    <li>ped.plで多型検出を行います。<br>
    $ perl ped.pl target=SRR11513115,ref=SARS-CoV-2,clipping=146<br>
    $ perl ped.pl target=SRR11513116,ref=SARS-CoV-2,clipping=146<br>
    $ perl ped.pl target=SRR11513117,ref=SARS-CoV-2,clipping=146<br>
    $ perl ped.pl target=SRR11513118,ref=SARS-CoV-2,clipping=143<br>
    $ perl ped.pl target=SRR11542243,ref=SARS-CoV-2,clipping=100<br>
    $ perl ped.pl target=SRR11542244,ref=SARS-CoV-2,clipping=100<br>
    <li>Dockerを用いる場合は、以下のようにします。ped.plを直接実行する場合は不要です。<br>
    $ sudo apt install docker<br>
    $ sudo apt install docker.io<br>
    実行例<br>
    $ sudo docker pull akiomiyao/ped<br>
    $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl download.pl accession=SRR11513115,wd=/work <br>
    $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl ped.pl target=SRR11513115,ref=SARS-CoV-2,clipping=146,wd=/work <br>
    上記コマンドをコピー・ペーストしてアクセッション名等の値を修正して実行するのが楽です。<br>
    Googleのクラウドやアマゾンウェブサービス(AWS)でも実行可能です。
    <li>Integrative Genomics Viewer (IVG)を用いた結果の閲覧<br>
    Integrative Genomics Viewer (IVG)はBroad Instituteで作成されたアプリケーションです。<br>
Webアプリケーション <a href = "https://igv.org/app/" target = "_blank">https://igv.org/app/</a>が便利です<br>
<a href = "igv-web.png" target = "_blank"><img src = "igv-web.png" height = "30%"></a> クリックすると大きくなります。<br>
      
      Genomeのプルダウンメニューより Sars-CoV-2 (ASM985889v3)を選びます。<br>
      以下の解析済みvcfファイルをダウンロードします。 <br>
      'Tracks'のプルダウンメニューの中の'Local file'を選んでvcfファイルを取り込みます。 <br><br>
      
    
    もしIVGを自分のコンピュータで起動させて見たい場合は from <a href = "http://software.broadinstitute.org/software/igv/download" target = "_blank">http://software.broadinstitute.org/software/igv/download</a>よりプログラムをダウンロードしてインストールしてください。<br>
    IVG のGenomesのタブをクリックして、"SARS-CoV-2.fasta"と"SARS-CoV-2.gff"をロードします。<br>
    Fileタブをクリックして"ped/SRR11513115/SRR11513115.vcf"等にあるvcfファイルをロードして多型を表示させます。<br>
    <li>プログラムを一部修正したので、以前と少し見え方が変わっています。5'末端に近い変異で、正確にリード数がカウントできず、曖昧な部分がありましたので、末端からリード長分進んだところまでの変異は表示しないようにしました。
    <li>双方向アラインメント上の多型の確認<br>
    pedディレクトリで<br><br>
$ perl search.pl target=target,chr=chromosome,pos=position<br><br>
を実行します。
例えば<br><br>
$ perl search.pl target=SRR11542244,chr=NC_045512.2,pos=5872<br><br>
あるいは<br><br>
$ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl search.pl target=SRR11542244,chr=NC_045512.2,pos=5872,wd=/work <br><br>
以下は、出力の一部です。<br>

<pre># NC_045512.2 5872 NC_045512.2 5870 f deletion -1
CTTACAAAGTCCTCAGAATA GTTACTTATAAATTGGATGG 0
                                                  ChrNC_045512.2 5872
                                                  |
CTTACAAAGTCCTCAGAATACAAAGGTCCTATTACGGATGTTTTCTACAAAGAAAACAGTTACACAACAACCATAAAACCAGTTACTTATAAATTGGATG
||||||||||||||||||||||||||||||||||||||||||||||||||  |||    |     |  | |   ||| |   |   |   || | |   |
CTTACAAAGTCCTCAGAATACAAAGGTCCTATTACGGATGTTTTCTACAAGAAAACAGTTACACAACAACCATAAAACCAGTTACTTATAAATTGGATGG
 |   ||   |     |    || |  |   |   |    |||     ||||||||||||||||||||||||||||||||||||||||||||||||||||
TTACAAAGTCCTCAGAATACAAAGGTCCTATTACGGATGTTTTCTACAAAGAAAACAGTTACACAACAACCATAAAACCAGTTACTTATAAATTGGATGG
                                               |
                                               ChrNC_045512.2 5870
</pre>
    <li>確認用ファイル<br>
    <a href = "SARS-CoV-2.fasta" target = "_blank">SARS-CoV-2.fasta</a> From NCBI<br>
    <a href = "SARS-CoV-2.gff" target = "_blank">SARS-CoV-2.gff</a> From NCBI<br>
    <a href = "SRR11542243.count.vcf" target = "_blank">SRR11542243.count.vcf</a> Sample from University Malaya<br>
    <a href = "SRR11542244.count.vcf" target = "_blank">SRR11542244.count.vcf</a> Sample from University Malaya<br>
    <a href = "SRR11513115.count.vcf" target = "_blank">SRR11513115.count.vcf</a> Sample from Utah Public Health Laboratory<br>
    <a href = "SRR11513116.count.vcf" target = "_blank">SRR11513116.count.vcf</a> Sample from Utah Public Health Laboratory<br>
    <a href = "SRR11513117.count.vcf" target = "_blank">SRR11513117.count.vcf</a> Sample from Utah Public Health Laboratory<br>
    <a href = "SRR11513118.count.vcf" target = "_blank">SRR11513118.count.vcf</a> Sample from Utah Public Health Laboratory<br>
    <li>コメント<br>
    Intel Core i5-4210M CPU @ 2.60 GHz (2 cores, 4 threads), 8GB memoryのコンピュータで2分ほどで結果がでます。<br>
    イルミナのシーケンサではきれいな結果が得られますが、nanoporeではノイズが多い結果になります。さらなる条件検討が必要です。<br>
    vcfファイルはtarget.vcf、target.full.vcf、target.count.vcfの3種類が出力されます。<br>
    ・target.vcfは検出された多型を持つリードと持たないリードを数えて遺伝子型が出力されています。IGVでは転座に関して対応していないのと、大きな欠失があると見づらくなるので、80bpの欠失や転座は出力しないようにしています。<br>
    ・target.full.vcfは、上記のフィルターをかける前の結果です。<br>
    ・target.count.vcfは多型を持つリードと持たないリードの数を調べずに、単純にリードから検出された多型の数でまとめた結果です。<br>
    SARS-CoV-2の場合、ウイルス自体が単一でなく変異が異なる複数の種類のウイルスが混在しているので、厚く読んだデータの場合通常のvcfファイルでは、うまく検出されない場合が多いことがわかりました。検算をしないで、それぞれの部位で何回変異が検出されたかを出力しているtarget.count.vcfファイルで変異を確認することをお勧めします。
    <li>謝辞<br>
    Dr Ilkka HavukkalaにPEDのテストをしてもらいました。また、IVGに関する有益なアドバイスをもらいました。<br>
    </ul>
      <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
      </ul> 
      <h2>お問い合わせ</h2>
〒305-8518<br>
茨城県つくば市観音台2-1-2<br>
農研機構次世代作物開発研究センター<br>
宮尾安藝雄 (miyao@affrc.go.jp)<br>
  </body>
</html>
