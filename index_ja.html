<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "default.css">
  <head>
    <body>
      <h1>PEDを用いた多型検出</h1>
      <h2>PEDのインストール</h2>
      Unix (Linux)がインストールされたコンピュータでの作業となります。
      <ul>
	<li>プログラムのダウンロード<br>
	  <a href = "https://github.com/akiomiyao/ped" target = "_blank">https://github.com/akiomiyao/ped</a>にアクセスして、<br>
	  Clone or downloadのプルダウンメニューよりzipファイルをダウンロードする。あるいは、<br>
	  git clone https://github.com/akiomiyao/ped<br>
	  を実行する。
	<li>以後の作業は、展開されたpedあるいはped-masterのディレクトリで作業する。git cloneで展開した場合は、展開したディレクトリで<br>
	  git pull<br>
	  を実行すると、最新のスクリプトに同期される。
    <li>農研機構高度解析センターのコンピュータクラスターを用いる場合は、<br>
    common.pl の中の<br>
    # $qsub_opt = "-S /usr/bin/perl -jc M.c8";<br>
    の行のコメントアウトを外して、<br>
    $qsub_opt = "-S /usr/bin/perl -jc M.c8";<br>
    としてセーブしなおしてから実行する必要がある。
	  </ul>
	<h2>リファレンスゲノムデータセットの作成</h2>
	<ul>
	  <li>引数なしで実行するとヘルプと対応しているゲノムがリストされる。<br>
	  perl mkref.pl<br>
	  <li>イネ(日本晴)データセットは、<br>
	  perl mkref.pl IRGSP1.0<br>
	  を実行する。<br>
	  <li>IRGSP1.0をhg38にするとヒトのデータセットができる。<br>
	  perl mkref.pl hg38<br>
	  ヒトの場合はサイズが大きいので、作成に1日程度かかる。<br>
	</ul>
	<h2>fastq-dumpのインストール</h2>
	<ul>
	  <li><a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software" target = "_blank">https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software</a><br>
	  から、コンパイルされた実行ファイルのアーカイブをダウンロードする。<br>
	  <li>OSがCentOSなら、CentOS Linux 64 bit architecture - non-sudo tar archiveをダウンロードする。<br>
	  tar xvzf ファイル名<br>
	  で展開できる。<br>
	  tar xvzf sratoolkit.2.10.0-centos_linux64.tar.gz<br>
	  <li>展開されたディレクトリの中のbinの中にある、fastq-dump-orig.2.10.0をユーザのホームディレクトリのbinディレクトリにfastq-dumpというファイル名でコピーする。<br>
	  例<br>
	  cp sratoolkit.2.10.0-centos_linux64/bin/fastq-dump-orig.2.10.0 ~/bin/fastq-dump
	  </ul>
	<h2>Fastqデータの取得</h2>
	<ul>
	<li>解析対象のfastqデータ<br>
	  日本晴 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR099989" target = _blank">DRR099989</a><br>
	  コシヒカリ <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR054198" target = _blank">DRR054198</a><br>
	<li>download.plを実行する。<br>
	  perl download.pl DRR099989<br>
	  perl download.pl DRR054198<br>
	<li>pedのディレクトリの中に、DRR054198とDRR099989のディレクトリが作成され、その中のreadのディレクトリの中にfastqファイルがダウンロードされる。<br>
	  fastqファイルは、gz形式やbz2形式で圧縮されていても、そのまま解析が可能である。<br>
	  ターゲット名のディレクトリ下のreadディレクトリの中に置いたファイルがまとめて解析される。<br>
	  ペアエンドのデータでも複数のシングルエンドのデータでも解析されるが、ファイルの圧縮形式は揃っている必要がある。<br>
	 <li>PEDではリード長が一定している必要がある。リード長がばらついているデータは、長さを揃える必要がある。
	 </ul>
	<h2>bidirectional法での多型の検出</h2>
	  bidirectional法では、SNP以外に、挿入、欠失、逆位、転座等の構造変異も検出される。<br>
	  <ul>
	  <li>perl bidirectional.pl ターゲット コントロール リファレンス<br>
	  例<br>
	  perl bidirectional.pl DRR054198 DRR099989 IRGSP1.0<br>
	  <li>この場合は、DRR054198のディレクトリ内に結果ファイルがセーブされる。<br>
	  比較対象のリードがなく、多型のマップ情報のみを得る場合は、<br>
	  perl bidirectional.pl DRR054198 default IRGSP1.0<br>
	  のように、controlの値をdefaultにすると、リファレンスゲノム自体をコントロールとしてカウントした結果が得られる。
	  </ul>
	<h2><i>k</i>-mer法での多型の検出</h2>
	  <i>k</i>-mer法は、SNPの検出のみとなる。
	  <ul>
	  <li>perl kmer.pl ターゲット コントロール リファレンス<br>
	  例<br>
	  perl kmer.pl  DRR054198 DRR099989 IRGSP1.0<br>
	  <li>この場合は、DRR054198のディレクトリ内に結果ファイルがセーブされる。<br>
	  比較対象のリードがなく、多型のマップ情報のみを得る場合は、<br>
	  perl bidirectional.pl DRR054198 default IRGSP1.0<br>
	  のように、controlの値をdefaultにすると、リファレンスゲノム自体をコントロールとしてカウントした結果が得られる。
	  </ul>
	<h2>グリッドエンジンを用いた並列計算</h2>
	  Torqueをインストールする必要がある。<br>
	  <ul>
	  <li>マルチコアのコンピュータの場合、スタンドアロンのコンピュータでも動作するが、十分なメモリを搭載する必要がある。<br>
      メモリ不足でエラーになった場合は、qsub_が頭につかないスクリプトで解析する必要がある。<br>
	  Torqueのインストール方法は<a href = "https://github.com/akiomiyao/ped/wiki/Install-of-Torque" target = "_blank">こちら</a>。<br>
	  <li>perl qsub_bidirectional.pl ターゲット コントロール リファレンス<br>
	  perl qsub_bidirectional.pl DRR054198 DRR099989 IRGSP1.0<br>
	  グリッドエンジンを用いて高速に計算することができる。
      <li>各ノードに1TB程度のSSDを搭載してテンポラリーディレクトリに指定するとより高速に処理ができる。<br>
      perl qsub_bidirectional.pl ターゲット コントロール リファレンス テンポラリーディレクトリ<br>
      perl qsub_bidirectional.pl DRR054198 DRR099989 IRGSP1.0 /mnt/ssd<br>
      のように実行する。リファレンスデータ等が /mnt/ssd にコピーされて保持されるのでマスター・ノード間のネットワークの負荷が軽減される。<br>
      ヒトのデータしか解析しないような場合に利用すると効率的である。
      </ul>
    <h2>解析事例</h2>
      <ul>
       <li>イネの早生・晩稲分離個体のバルク解析による関係領域の推定
         <ul>
          <li>日本稲の日本晴とインド型稲のカサラスを交配した個体の自殖個体(F2世代)は、出穂の表現型が早生と晩稲に分離する。<br>
              日本晴でバッククロスした個体の自殖個体の早生型と晩稲型の個体のバルクからのNGSデータを解析した。
          <li>早生データ: <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056225" target = "_blank">DRR056225</a>
<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056226" target = "_blank">DRR056226</a>、
晩稲データ: <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056227" target = "_blank">DRR056227</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056228" target = "_blank">DRR056228</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056229" target = "_blank">DRR056229</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056230" target = "_blank">DRR056230</a>
          <li>pedディレクトリ下にearly/readとlate/readのディレクトリを作り、fastqデータをセーブする。<br>
              cd ped<br>
              mkdir early<br>
              mkdir early/read<br>
              mkdir late<br>
              mkdir late/read<br>
              mv DRR056225_1.fastq DRR056225_2.fastq DRR056226_1.fastq DRR056226_2.fastq early/read<br>
              mv DRR056227_1.fastq DRR056227_2.fastq DRR056228_1.fastq DRR056228_2.fastq DRR056229_1.fastq DRR056229_2.fastq DRR056230_1.fastq DRR056230_2.fastq late/read<br>
           <li>イネのリファレンスデータを作り、bidirectional法で多型情報を取得する。<br>
              perl mkref.pl IRGSP1.0<br>
              perl bidirectional.pl early late IRGSP1.0
           <li>イネの全配列長を1000当分して、各ブロックに存在する早生型、晩稲型で検出されたSNP座位数を調べて、晩稲型SNP数 - 早生型SNP数をプロットした。<br>
              <a href = "delta.png" target = "_blank"><img src = "delta.png" width = "10%"></a>
           <li>第6染色体の上腕部分に早生型で検出されるSNPが多く検出され、その後に晩稲型SNPが多く検出される領域が続いている。<br>
               この領域にそれぞれ早生、晩稲に関与する遺伝子座が存在する。
           <li>文献: <a href = "https://www.jstage.jst.go.jp/article/jsbbs/67/2/67_16096/_article" target = "_blank">Detection of novel QTLs qDTH4.5 and qDTH6.3, which confer late heading under short-day conditions, by SSR marker-based and QTL-seq analysis. Breed Sci. 67(2):101-109 (2017).</a>
           <li><a href = "https://github.com/akiomiyao/ped/wiki/Bulked-segrigant-analysis-of-rice" target = "_blank">英文リンク</a>
         </ul>
      </ul> 

    <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
      </ul> 
    <h2>その他のお役立ち情報</h2>
      <ul>
      <li>NGSデータから転移したトランスポゾンを検出する方法 <a href = "https://github.com/akiomiyao/tif/" target = "_blank">Transposon Insertion Finder (TIF)</a>
      <li>ミュータントパネルデータベース <a href = "https://tos.nias.affrc.go.jp" target = "_blank">https://tos.nias.affrc.go.jp</a> 
      </ul>
    <h2>連絡先</h2>
    〒305-8518<br>
    茨城県つくば市観音台2-1-2<br>
    <a href = "http://www.naro.affrc.go.jp/" target = "_blank">農研機構</a>次世代作物開発研究センター<br>
    宮尾安藝雄 (<a href = "mailto:miyao@affrc.go.jp">miyao@affrc.go.jp</a>)<br>
    </body>
</html>
