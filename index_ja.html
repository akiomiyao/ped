<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "default.css">
  <head>
    <body>
      <h1>PEDを用いた多型検出</h1>
      <h2>PEDのインストール</h2>
      Unix (Linux)がインストールされたコンピュータでの作業となります。
      <ul>
	<li>プログラムのダウンロード<br>
	  <a href = "https://github.com/akiomiyao/ped" target = "_blank">https://github.com/akiomiyao/ped</a>にアクセスして、<br>
	  Clone or downloadのプルダウンメニューよりzipファイルをダウンロードする。あるいは、<br>
	  git clone https://github.com/akiomiyao/ped<br>
	  を実行する。
	<li>以後の作業は、展開されたpedあるいはped-masterのディレクトリで作業する。git cloneで展開した場合は、展開したディレクトリで<br>
	  git pull<br>
	  を実行すると、最新のスクリプトに同期される。
	<li>Dockerで実行する場合は、<br>
		<a href = "https://hub.docker.com/r/akiomiyao/ped" target = "_blank">https://hub.docker.com/r/akiomiyao/ped</a><br>
		から最新版のイメージを公開している。Dockerファイルでは、PED以外に、fastq-dumpもセットアップ済みである。<br>
		# docker run -v /home/your_account/data_dir:/work -it akiomiyao/ped<br>
		で稼働できる。<br>
		docker run した後、/ped を /workにmvして、<br>
		cd /work/ped<br>
		と、/workに移したpedのディレクトリの中で作業を行うと、dockerを終了しても実行結果が/home/your_account/data_dirに残り便利である。<br>
    <li>農研機構高度解析センターのコンピュータクラスターを用いる場合は、<br>
    common.pl の中の<br>
    # $qsub_opt = "-S /usr/bin/perl -jc M.c8";<br>
    の行のコメントアウトを外して、<br>
    $qsub_opt = "-S /usr/bin/perl -jc M.c8";<br>
    としてセーブしなおしてから実行する必要がある。
	  </ul>
	<h2>リファレンスゲノムデータセットの作成</h2>
	<ul>
	  <li>引数なしで実行するとヘルプと対応しているゲノムがリストされる。<br>
	  perl mkref.pl<br>
	  <li>イネ(日本晴)データセットは、<br>
	  perl mkref.pl IRGSP1.0<br>
	  を実行する。<br>
	  <li>IRGSP1.0をhg38にするとヒトのデータセットができる。<br>
	  perl mkref.pl hg38<br>
	  ヒトの場合はサイズが大きいので、作成に1日程度かかる。<br>
	</ul>
	<h2>fastq-dumpのインストール</h2>
	<ul>
	  <li><a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software" target = "_blank">https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software</a><br>
	  から、コンパイルされた実行ファイルのアーカイブをダウンロードする。<br>
	  <li>OSがCentOSなら、CentOS Linux 64 bit architecture - non-sudo tar archiveをダウンロードする。<br>
	  tar xvzf ファイル名<br>
	  で展開できる。<br>
	  tar xvzf sratoolkit.2.10.0-centos_linux64.tar.gz<br>
	  <li>展開されたディレクトリの中のbinの中にある、fastq-dump-orig.2.10.0をユーザのホームディレクトリのbinディレクトリにfastq-dumpというファイル名でコピーする。<br>
	  例<br>
	  cp sratoolkit.2.10.0-centos_linux64/bin/fastq-dump-orig.2.10.0 ~/bin/fastq-dump
	  </ul>
	<h2>Fastqデータの取得</h2>
	<ul>
	<li>解析対象のfastqデータ<br>
	  日本晴 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR099989" target = _blank">DRR099989</a><br>
	  コシヒカリ <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR054198" target = _blank">DRR054198</a><br>
	<li>download.plを実行する。<br>
	  perl download.pl DRR099989<br>
	  perl download.pl DRR054198<br>
	<li>pedのディレクトリの中に、DRR054198とDRR099989のディレクトリが作成され、その中のreadのディレクトリの中にfastqファイルがダウンロードされる。<br>
	  fastqファイルは、gz形式やbz2形式で圧縮されていても、そのまま解析が可能である。<br>
	  ターゲット名のディレクトリ下のreadディレクトリの中に置いたファイルがまとめて解析される。<br>
	  ペアエンドのデータでも複数のシングルエンドのデータでも解析されるが、ファイルの圧縮形式は揃っている必要がある。<br>
	 <li>PEDではリード長が一定している必要がある。リード長がばらついているデータは、長さを揃える必要がある。
	 </ul>
	<h2>bidirectional法での多型の検出</h2>
	  bidirectional法では、SNP以外に、挿入、欠失、逆位、転座等の構造変異も検出される。<br>
	  <ul>
	  <li>perl bidirectional.pl ターゲット コントロール リファレンス<br>
	  例<br>
	  perl bidirectional.pl DRR054198 DRR099989 IRGSP1.0<br>
	  <li>この場合は、DRR054198のディレクトリ内に結果ファイルがセーブされる。<br>
	  比較対象のリードがなく、多型のマップ情報のみを得る場合は、<br>
	  perl bidirectional.pl DRR054198 default IRGSP1.0<br>
	  のように、controlの値をdefaultにすると、リファレンスゲノム自体をコントロールとしてカウントした結果が得られる。
	  </ul>
	<h2><i>k</i>-mer法での多型の検出</h2>
	  <i>k</i>-mer法は、SNPの検出のみとなる。
	  <ul>
	  <li>perl kmer.pl ターゲット コントロール リファレンス<br>
	  例<br>
	  perl kmer.pl  DRR054198 DRR099989 IRGSP1.0<br>
	  <li>この場合は、DRR054198のディレクトリ内に結果ファイルがセーブされる。<br>
	  比較対象のリードがなく、多型のマップ情報のみを得る場合は、<br>
	  perl bidirectional.pl DRR054198 default IRGSP1.0<br>
	  のように、controlの値をdefaultにすると、リファレンスゲノム自体をコントロールとしてカウントした結果が得られる。
	  </ul>
	<h2>グリッドエンジンを用いた並列計算</h2>
	  Torqueをインストールする必要がある。<br>
	  <ul>
	  <li>マルチコアのコンピュータの場合、スタンドアロンのコンピュータでも動作するが、十分なメモリを搭載する必要がある。<br>
      メモリ不足でエラーになった場合は、qsub_が頭につかないスクリプトで解析する必要がある。<br>
	  Torqueのインストール方法は<a href = "https://github.com/akiomiyao/ped/wiki/Install-of-Torque" target = "_blank">こちら</a>。yumで簡単にインストールできる。<br>
      <li>CentOSを搭載した16CPU, 38GBのコンピュータにTorqueをインストールしてhg38ゲノムに対するヒトの多型データ検出に成功している。
	  <li>perl qsub_bidirectional.pl ターゲット コントロール リファレンス<br>
	  perl qsub_bidirectional.pl DRR054198 DRR099989 IRGSP1.0<br>
	  グリッドエンジンを用いて高速に計算することができる。
      <li>各ノードに1TB程度のSSDを搭載してテンポラリーディレクトリに指定するとより高速に処理ができる。<br>
      perl qsub_bidirectional.pl ターゲット コントロール リファレンス テンポラリーディレクトリ<br>
      perl qsub_bidirectional.pl DRR054198 DRR099989 IRGSP1.0 /mnt/ssd<br>
      のように実行する。リファレンスデータ等が /mnt/ssd にコピーされて保持されるのでマスター・ノード間のネットワークの負荷が軽減される。<br>
      ヒトのデータしか解析しないような場合に利用すると効率的である。
      </ul>
    <h2>解析事例</h2>
      <ul>
       <li>イネの早生・晩稲分離個体のバルク解析による関係領域の推定
         <ul>
          <li>日本稲の日本晴とインド型稲のカサラスを交配した個体の自殖個体(F2世代)は、出穂の表現型が早生と晩稲に分離する。<br>
              日本晴でバッククロスした個体の自殖個体の早生型と晩稲型の個体のバルクからのNGSデータを解析した。
          <li>早生データ: <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056225" target = "_blank">DRR056225</a>
<a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056226" target = "_blank">DRR056226</a>、
晩稲データ: <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056227" target = "_blank">DRR056227</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056228" target = "_blank">DRR056228</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056229" target = "_blank">DRR056229</a>
 <a href = "https://www.ncbi.nlm.nih.gov/sra/?term=DRR056230" target = "_blank">DRR056230</a>
          <li>pedディレクトリ下にearly/readとlate/readのディレクトリを作り、fastqデータをセーブする。<br>
              cd ped<br>
              mkdir early<br>
              mkdir early/read<br>
              mkdir late<br>
              mkdir late/read<br>
              mv DRR056225_1.fastq DRR056225_2.fastq DRR056226_1.fastq DRR056226_2.fastq early/read<br>
              mv DRR056227_1.fastq DRR056227_2.fastq DRR056228_1.fastq DRR056228_2.fastq DRR056229_1.fastq DRR056229_2.fastq DRR056230_1.fastq DRR056230_2.fastq late/read<br>
           <li>イネのリファレンスデータを作り、bidirectional法で多型情報を取得する。<br>
              perl mkref.pl IRGSP1.0<br>
              perl bidirectional.pl early late IRGSP1.0
           <li>イネの全配列長を1000当分して、各ブロックに存在する早生型、晩稲型で検出されたSNP座位数を調べて、晩稲型SNP数 - 早生型SNP数をプロットした。<br>
              <a href = "delta.png" target = "_blank"><img src = "delta.png" width = "10%"></a>
           <li>第6染色体の上腕部分に早生型で検出されるSNPが多く検出され、その後に晩稲型SNPが多く検出される領域が続いている。<br>
               この領域にそれぞれ早生、晩稲に関与する遺伝子座が存在する。
           <li>文献: <a href = "https://www.jstage.jst.go.jp/article/jsbbs/67/2/67_16096/_article" target = "_blank">Detection of novel QTLs qDTH4.5 and qDTH6.3, which confer late heading under short-day conditions, by SSR marker-based and QTL-seq analysis. Breed Sci. 67(2):101-109 (2017).</a>
           <li><a href = "https://github.com/akiomiyao/ped/wiki/Bulked-segrigant-analysis-of-rice" target = "_blank">英文リンク</a>
         </ul>
         <li>ヒトの多型検出
         <ul>
           <li>perl mkref.pl hg38<br>
           を実行してリファレンスを作る。
           <li>perl download.pl ERR194146<br>
           で、<a href = "https://www.ncbi.nlm.nih.gov/Traces/study/?acc=ERP001960&o=acc_s%3Aa" target = "_blank">CEPH/UTAH家系の父親のfastqデータ</a>をダウンロードする。<br>
           どういうわけか、最近息子のERR194152の配列がNCBI/SRAからダウンロードできなくなった。母親ERR194147は今のところダウンロード可能である。
           <li><pre>[miyao@cluster1 ped]$ perl qsub_bidirectional.pl ERR194146 default hg38
2019年 10月 16日 水曜日 16:30:24 JST Making ERR194146.sort_uniq.
2019年 10月 17日 木曜日 10:48:55 JST Aligning of ERR194146 sequence to hg38 genome.
2019年 10月 18日 金曜日 06:42:16 JST Splitting of Indel alignment.
2019年 10月 18日 金曜日 06:42:17 JST Splitting of SNP alignment.
2019年 10月 18日 金曜日 08:52:26 JST Verifying indel 01
2019年 10月 18日 金曜日 08:52:27 JST Verifying SNPs 01
2019年 10月 18日 金曜日 08:52:28 JST Verifying SNPs 02
2019年 10月 18日 金曜日 08:52:29 JST Verifying SNPs 03
2019年 10月 18日 金曜日 08:52:30 JST Verifying SNPs 04
2019年 10月 18日 金曜日 08:52:31 JST Verifying SNPs 05
2019年 10月 18日 金曜日 08:52:32 JST Verifying SNPs 06
2019年 10月 18日 金曜日 08:52:33 JST Verifying SNPs 07
2019年 10月 18日 金曜日 08:52:34 JST Verifying SNPs 08
2019年 10月 18日 金曜日 08:52:35 JST Verifying SNPs 09
2019年 10月 18日 金曜日 08:52:36 JST Verifying SNPs 10
2019年 10月 18日 金曜日 08:52:37 JST Verifying SNPs 11
2019年 10月 18日 金曜日 08:52:38 JST Verifying SNPs 12
2019年 10月 18日 金曜日 08:52:39 JST Verifying SNPs 13
2019年 10月 18日 金曜日 08:52:40 JST Verifying SNPs 14
2019年 10月 18日 金曜日 08:52:41 JST Verifying SNPs 15
2019年 10月 18日 金曜日 18:45:48 JST Making vcf file of SNP
2019年 10月 18日 金曜日 18:48:58 JST bidirectional.pl complete.</pre>
           <li>ERR194146.bi.vcf<br>
           にSNPのvcf形式マップデータがセーブされる。<br>
<pre>##fileformat=VCFv4.2
##FILTER=&lt;ID=PASS,Description="All filters passed"&gt;
##INFO=&lt;ID=GT,Number=1,Type=String,Description="Genotype"&gt;
##INFO=&lt;ID=DP,Number=1,Type=Integer,Description="Approximate read depth)"&gt;
##INFO=&lt;ID=AF,Number=.,Type=Float,Description="Allele Frequency"&gt;
##FORMAT=&lt;ID=GT,Number=1,Type=String,Description="Genotype"&gt;
##FORMAT=&lt;ID=AD,Number=.,Type=Integer,Description="Allelic depths for the reference and alternate alleles in the order listed"&gt;
##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description="Read depth"&gt;
#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  ERR194146
chr1    69511   .       A       G       1000    PASS    GT=1/1;AF=1;DP=19       GT:AD:DP        1/1:0,19:19
chr1    629275  .       A       C       1000    PASS    GT=0/1;AF=0.522;DP=44   GT:AD:DP        0/1:21,23:44
chr1    629275  .       A       G       1000    PASS    GT=0/1;AF=0.363;DP=33   GT:AD:DP        0/1:21,12:33
chr1    629306  .       A       C       1000    PASS    GT=0/1;AF=0.342;DP=70   GT:AD:DP        0/1:46,24:70
chr1    629487  .       A       C       1000    PASS    GT=0/1;AF=0.655;DP=61   GT:AD:DP        0/1:21,40:61
chr1    629626  .       T       C       1000    PASS    GT=0/1;AF=0.472;DP=36   GT:AD:DP        0/1:19,17:36
chr1    630318  .       A       C       1000    PASS    GT=0/1;AF=0.555;DP=45   GT:AD:DP        0/1:20,25:45
chr1    630318  .       A       G       1000    PASS    GT=0/1;AF=0.333;DP=30   GT:AD:DP        0/1:20,10:30
chr1    630775  .       A       C       1000    PASS    GT=0/1;AF=0.382;DP=68   GT:AD:DP        0/1:42,26:68
chr1    630875  .       A       C       1000    PASS    GT=0/1;AF=0.422;DP=175  GT:AD:DP        0/1:101,74:175
chr1    630899  .       A       C       1000    PASS    GT=0/1;AF=0.373;DP=150  GT:AD:DP        0/1:94,56:150
chr1    631286  .       A       C       1000    PASS    GT=0/1;AF=0.302;DP=139  GT:AD:DP        0/1:97,42:139
chr1    631811  .       C       T       1000    PASS    GT=0/1;AF=0.657;DP=35   GT:AD:DP        0/1:12,23:35
chr1    632574  .       A       C       1000    PASS    GT=0/1;AF=0.32;DP=134   GT:AD:DP        0/1:91,43:134
chr1    632692  .       A       G       1000    PASS    GT=0/1;AF=0.694;DP=59   GT:AD:DP        0/1:18,41:59
chr1    632693  .       T       A       1000    PASS    GT=0/1;AF=0.547;DP=42   GT:AD:DP        0/1:19,23:42</pre>
           PEDでは、bwaを使わず独自の方法でマッピングしているので、クオリティースコアの算出が難しい。<br>
           そのため、クオリティースコアは1000の固定値となっている。<br>
           多型のクオリティーは、サポートされるリードのカバー数(DP)で判断してもらいたい。<br>
           vcfの元データは、ERR194146.bi.snpとなっている。<br>
           一番右にMと表示されている行がホモ変異、Hがヘテロと判定している。<br>
           <li>構造変異は、ERR194146.sv<br>
           に出力される。
           <pre>[miyao@cluster1 ERR194146]$ egrep 'M|H' ERR194146.sv|head  -n 30
1       61361   15      101929373       r       translocation           50      0       23      10      H       TTTTCAAAATTCTTAATAAACCATTTATTCCTTCAACTTTCTATGCCATTTGATGTTTTGTAAAAAAAAAA
1       630059  2       102215022       f       translocation           50      0       17      10      H       C
1       634925  16      10724035        r       translocation           50      0       16      12      H       TCTCCCTTCACCATTTCCGACGGCATCTACGG
1       634925  5       100051350       r       translocation           50      0       16      15      H       TCTCCCTTCACCATTTC
1       790979  1       790943  f       deletion        -10     50      0       16      31      H       GAATGGAATGGAATGGAATGGAATGGAATGGAATGGAATGGAATG
1       840424  1       840410  f       deletion        -1      50      0       8       9       H       AAAAAAAAAAAAAA
1       855380  1       855380  f       deletion        -2      50      0       11      13      H       T
1       897794  1       897792  f       insertion       4       50      0       20      18      H       GAA
1       902788  1       902774  f       deletion        -1      50      0       10      9       H       AAAAAAAAAAAAAA
1       907869  1       907835  f       insertion       32      50      0       19      11      H       C
1       911222  1       911221  f       deletion        -1      50      0       21      15      H       T
1       923312  1       923312  f       deletion        -1      50      0       0       34      M
1       932618  1       932617  f       deletion        -4      50      0       1       32      M       TTTC
1       939575  1       939570  f       insertion       12      50      0       14      16      H       GGAGGACC
1       939785  1       939797  f       deletion        -18     50      0       18      20      H       GCCAG
1       945261  1       945260  f       deletion        -1      50      0       21      12      H       C
1       949175  1       949175  f       deletion        -4      50      0       10      11      H       AGA
1       950670  1       950672  f       deletion        -3      50      0       0       11      M
1       959515  1       959510  f       insertion       4       50      0       1       13      M
1       960382  1       960375  f       insertion       1       50      0       0       7       M       GGGGG
1       967383  1       967377  f       deletion        -1      50      1       0       7       M       CCCCCC
1       967386  1       967377  f       deletion        -1      50      0       0       7       M       CCCCCCCCC
1       971793  1       971791  f       deletion        -1      50      0       18      22      H       GG
1       989072  1       989072  f       deletion        -4      50      0       0       21      M       TTG
1       1013468 1       1013466 f       insertion       1       50      0       1       9       M
1       1014737 1       1014737 f       deletion        -4      50      0       1       20      M       AAG
1       1019486 1       1019480 f       deletion        -1      50      0       0       10      M       GGGGGG
1       1020069 1       1020061 f       deletion        -1      50      0       0       7       M       CCCCCCCC
1       1022591 1       1022587 f       insertion       23      50      0       1       28      M       AGTCTGACCTGTGGTCTGAC
1       1043224 1       1043225 f       deletion        -2      50      0       1       27      M
</pre>
         各カラムの値の対応関係は、<a href = "https://github.com/akiomiyao/ped/" target = "_blank">README.md</a>を参照のこと。
         <li>translocationに関しては、散在しているリファレンスゲノム上の反復配列で比較的多くのSNPがある場合、それぞれユニークな配列として認識される。対象配列の反復配列にさらにSNPが入った場合、別の染色体に存在している反復配列領域と偶然認識される場合がある。あるいは、ERR194146配列のもとになったDNAは、培養細胞由来なので長期間の培養の間に、一部の細胞に変異が入った可能性も考えられる。反復配列領域の確認はサザンハイブリダイゼーションでは、スメアになり転座の確認は難しい。対象部位の上流と下流で確実にユニークと思われる部分にプライマーを設計して、Long PCRで想定サイズの断片が増幅されれば、転座の確認ができる。
         <li>数塩基の挿入・欠失は、1～数塩基の単純反復配列の反復数の変動の場合が多い。最後のカラムは、検出されたエッジに挟まれた部分の配列で、この部分に反復配列が認められる場合は、単純反復配列の反復数の変動である。
         </ul>
      </ul> 

    <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
      </ul> 
    <h2>その他のお役立ち情報</h2>
      <ul>
      <li>NGSデータから転移したトランスポゾンを検出する方法 <a href = "https://github.com/akiomiyao/tif/" target = "_blank">Transposon Insertion Finder (TIF)</a>
      <li>ミュータントパネルデータベース <a href = "https://tos.nias.affrc.go.jp" target = "_blank">https://tos.nias.affrc.go.jp</a> 
      </ul>
    <h2>取扱い会社</h2>
      <ul>
      <li><a href = "https://gikenbio.com/" target = "_blank">株式会社生物技研</a>
      </ul>
    <h2>連絡先</h2>
    〒305-8518<br>
    茨城県つくば市観音台2-1-2<br>
    <a href = "http://www.naro.affrc.go.jp/" target = "_blank">農研機構</a>次世代作物開発研究センター<br>
    宮尾安藝雄 (<a href = "mailto:miyao@affrc.go.jp">miyao@affrc.go.jp</a>)<br>
    </body>
</html>
