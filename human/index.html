<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "../default.css">
  <head>
    <body>
      <h1>PEDを用いたヒトの多型解析例</h1>
      <a href = "../index_ja.html">[日本語トップページへのリンク]</a><br><br>
      <b>ここでは、<a href = "https://www.illumina.com/platinumgenomes.html" target = "_blank">Illumina社が解析して公開したプラチナゲノムの配列データ</a>の多型の検出を例に、Linux(Ubuntu)のインストール、PEDのセットアップ、ゲノムブラウザでの結果の表示の方法を紹介します。</b><br><br>
<a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/?run=ERR194146" target = "_blank">ERR194146</a>と
      <a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/?run=ERR194147" target = "_blank">ERR194147</a>の配列データを例に解析手順を紹介します。<br>
      <ul>
      <li><a href = "http://software.broadinstitute.org/software/igv/" target = "_blank">IGV Desktop</a><br>
<a href = "ERR194146_ERR194147.png" target = "_blank"><img src = "ERR194146_ERR194147.png" height = "30%"></a><br>
<a href = "https://igv.org/app/" target = "_blank">IGV Web Application</a><br><a href = "ERR194146.png" target = "_blank"><img src = "ERR194146.png" height = "30%"></a>
<li>IGVでの表示例です。図をクリックすると拡大されます。
<li>SNP以外に、<b>挿入・欠失変異も正確に検出できる</b>特徴があります。
<li>変異部分を増幅する<b>プライマー対の配列</b>も得られます。
<li>PEDでの解析結果例(vcf形式)<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146.vcf" target = "_blank">ERR194146.vcf</a>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146.vcf.idx" target = "_blank">ERR194146.vcf.idx</a><br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194147.vcf" target = "_blank">ERR194147.vcf</a>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194147.vcf.idx" target = "_blank">ERR194147.vcf.idx</a><br><br>

<li>次に、ショートリードデータ<b>ERR194158</b>に対する父由来<b>ERR194146</b>および母由来<b>ERR194159</b>の多型を検出しました。<br>
<a href = "ERR194146_ERR194158_ERR194159.png" target = "_blank"><img src = "ERR194146_ERR194158_ERR194159.png" height = "37%"></a>

<li>ERR194158とERR194159をそれぞれコントロールにして、PEDでERR194146に対する多型を検出しました。
<li>PEDではコントロール側で検出された多型はvcfファイルから除かれて出力されます。
<li>ERR194146vsERR194159は父親特異的、ERR194146vsERR194158は母親特異的多型のデータとなります。
<li>左のIGVの画面では、父親由来、および、母親由来のセグメントが明瞭に確認できます。
<li>以下は、解析済みの特異的多型のvcfファイルのリンクです。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146vsERR194158.vcf" target = "_blank">ERR194146vsERR194158.vcf</a> (母親特異的多型のvcfファイル)<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146vsERR194159.vcf" target = "_blank">ERR194146vsERR194159.vcf</a> (父親特異的多型のvcfファイル)
</ul>

      <h2>Ubuntuのインストール</h2>
      <ul>
      <li><a href = "https://www.ubuntulinux.jp/download/ja-remix" target = "_blank">Ubuntu Desktop 日本語 Remix</a>より日本語版のISOイメージのファイルをダウンロードします。
      <li><a href = "https://linuxfan.info/ubuntu-20-04-install-guide" target = "_blank">Ubuntu 20.04 LTSインストールガイド【スクリーンショットつき解説】</a>が詳しいので参考にしてインストールしてください。<br>
PEDは解析時間をできるだけ短くするため、CPUの限界近くまで負荷がかかりますのでほかのOSとの共存は避けた方がいいです。使わなくなった古いコンピュータなどにインストールして専用にするのがお勧めです。<br>
      マルチスレッドで動作しますので、4コア、あるいは8コアのCPUを用いると早く結果が得られます。
      </ul>
      <h2>PEDのセットアップと解析例</h2>
      <ul>
      <li>必要なソフトをダウンロードとインストールを行います。
      <pre>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install curl
$ sudo apt install git
$ sudo apt install sra-toolkit
$ git clone https://github.com/akiomiyao/ped.git</pre>
      <li>Ubuntuのバージョンによっては、sra-toolkitのインストールに失敗することがあります。<br>
また最近のバージョンのfastq-dumpは使用前にvdb-configコマンドで実行環境を設定する必要があります。<br>
設定方法は、<a href = "../sratoolkit/index_ja.html" target = "_blank">[fastq-dumpの設定]</a>のページに記載しました。
      <li>NCBIのSRAアーカイブからヒトのプラチナゲノム配列のfastq形式のファイル(ERR194146とERR194147)をダウンロードします。
      <pre>$ cd ped
$ git pull
$ perl download.pl accession=ERR194146
$ perl download.pl accession=ERR194147</pre>
git pullで最新のスクリプトに更新されます。<br>
pedのディレクトリの中に、ERR194146とERR194147の名称のディレクトリができて、その中のreadというディレクトリの中にfastqファイルがダウンロードされます。<br>
アメリカからのダウンロードなので時間がかかります。回線の状況によっては、1～2日かかるかもしれません。<br>
時々エラーが表示されますが自動的に再接続されるので、気長に待ちます。<br>
同様の構造の任意の名前のディレクトリを作れば手持ちのデータの解析ができます。<br>
<li>ダウンロードがうまくいかない場合は、DDBJにもデータがあります。<br>
<a href = "https://ddbj.nig.ac.jp/DRASearch/run?acc=ERR194146" target = "_blank">https://ddbj.nig.ac.jp/DRASearch/run?acc=ERR194146</a><br>
<a href = "https://ddbj.nig.ac.jp/DRASearch/run?acc=ERR194147" target = "_blank">https://ddbj.nig.ac.jp/DRASearch/run?acc=ERR194147</a><br>
のページのFASTQのリンクをクリックするとダウンロードできます。<br>
DDBJのデータは圧縮されていますが、ped/ERR194146/readあるいはped/ERR194147/readのディレクトリの中に置けばそのままPEDで解析できます。


      <li>ERR194146とERR194147の配列をヒトの参照配列hg19にマップして多型を検出します。
<pre>$ perl ped.pl target=ERR194146,ref=hg19
$ perl ped.pl target=ERR194147,ref=hg19</pre>
ヒトの参照配列は設定済みなので自動的にダウンロードして解析用データを作成して一連の作業が自動的に進みます。<br>
解析が無事終わるとERR194146とERR194147のディレクトリの中に、ERR194146.vcfとERR194147.vcfという結果をまとめたファイルができます。<br>
各座位に対してプライマーが作成可能な場合は、プライマーペアの配列データも出力されます。
      <li>コントロールを設定する場合は、以下のようにします。
<pre>$ perl ped.pl target=ERR194146,control=ERR194158,ref=hg19
$ perl ped.pl target=ERR194146,control=ERR194159,ref=hg19</pre>
      コントロール側には存在しない多型のみが出力されます。
      </ul>
      <h2>Dockerでの解析</h2>
      <ul>
      <li>Dockerを用いれば、必要な時に設定済み実行環境を取り込んで解析できます。<br>
      グーグルクラウド(GCP)やアマゾンウェブサービス(AWS)などのクラウドでの実行も可能です。
      <li>Dockerのセットアップ<br>
      $ sudo apt install docker<br>
      $ sudo apt install docker.io<br>
      <li>解析例<br>
      $ sudo docker pull akiomiyao/ped<br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl download.pl accession=ERR194146,wd=/work <br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl ped.pl target=ERR194146,ref=hg19,wd=/work <br>
      上記のコマンドをコピーしてターミナルウインドウにペーストして実行してください。<br>
      </ul>
      <h2>IVGブラウザによる結果の確認</h2>
      <ul>
      <li>Integrative Genomics Viewer (IVG) はBroad Instituteで作成されたゲノムブラウザです。<br>
IVGのウェブアプリ <a href = "https://igv.org/app/" target = "_blank">https://igv.org/app/</a> が便利です。<br>
<a href = "igsf3l.png" target = "_blank"><img src = "igsf3l.png" height = "10%"></a>
<a href = "igsf3.png" target = "_blank"><img src = "igsf3.png" height = "10%"></a>
<a href = "ERR194146.png" target = "_blank"><img src = "ERR194146.png" height = "10%"></a> 図をクリックすると大きくなります。<br>
      少し下にリンクされている解析済みvcfファイルをダウンロードします。<br>
      プルダウンメニューのTracksの中の'Local file ...'からvcfファイルを指定します。サイズが大きいので取り込みには数分かかることもあります。<br>
      Tracksのプルダウンメニューの'Platinum Genomes ...'から、NA12877あるいはNA12878を選ぶとイルミナ社の解析データGoogle Public datasetから提供されている多型マップが表示されます。<a href = "http://dx.doi.org/10.1101/gr.210500.116" target = "_blank">(Eberle, MA et al., 2017)</a><br>
NA12877、NA12878は個体番号で、それぞれ配列アクセッション名のERR194146、ERR194147に対応します。<br>
いずれかの染色体を選んで、+をクリックしてどんどん拡大していくと、多型部位が見えてきます。<br>

イルミナ社の解析データは、6種類の異なる多型検出プログラムを組み合わせた複雑なパイプラインで得られましたが、PEDの場合は、上記の1行のped.plの実行コマンドで高精度の結果が得られることがわかります。
<li>ご自分のコンピュータでIGVを走らせたい場合は、<a href = "http://software.broadinstitute.org/software/igv/download" target = "_blank">http://software.broadinstitute.org/software/igv/download</a> からダウンロードできます。<br>

ERR194146.vcfとERR194147.vcfをメインの表示ボックスにドラッグすれば、ヒトの多型データが取り込まれます。<br>
データのサイズが大きいので、インデックスを作成しますかと尋ねれますので、OKを押してしばらく待つとインデックスができて表示されます。<br>
私が持っているWindows10のノートパソコンでは、インデックス作成の途中でメモリ不足になりフリーズしてしまいました。<br>
メモリが8GBのUbuntuのコンピュータでは、止まらずインデックスができましたが、初回は表示に失敗する場合があるみたいてす。<br>
いったんIGVを閉じて立ち上げなおして読み込ませると取り込まれます。<br>
各染色体の番号をクリックすると、染色体ごとの多型情報が表示されます。<br>
興味のある部分をクリックすると、どんどん拡大されます。<br>
多型をマウスで指すと詳細情報が表示されます。<br>
多型の種類や多型頻度、また、プライマー対の配列情報と増幅産物のサイズも表示されます。<br>
      <li><a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146.vcf" target = "_blank">ERR194146.vcf</a><br>
      <a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146.vcf.idx" target = "_blank">ERR194146.vcf.idx</a><br>
      <a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194147.vcf" target = "_blank">ERR194147.vcf</a><br>
      <a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194147.vcf.idx" target = "_blank">ERR194147.vcf.idx</a><br>
      <a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146vsERR194158.vcf" target = "_blank">ERR194146vsERR194158.vcf</a> (母親特異的)<br>
      <a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200511AMVT/ERR194146vsERR194159.vcf" target = "_blank">ERR194146vsERR194159.vcf</a> (父親特異的)<br>
      に解析済みデータを置きました。比較検証にご利用ください。
      <li><b>注意点</b> IVGでは長い欠失や転座の情報をうまく表示できない場合があるので、転座と80塩基以上の欠失に関しては、vcfファイルに出力しないように設定しています。<br>
大きな構造変異を調べたい場合は、targetのディレクトリの中に出力された、svの拡張子のついたファイルを直接ご参照ください。
      </ul>
      <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
       <li>Platinum Genomeの論文: <a href = "http://dx.doi.org/10.1101/gr.210500.116" target = "_blank">Eberle, MA et al. (2017) A reference data set of 5.4 million phased human variants validated by genetic inheritance from sequencing a three-generation 17-member pedigree. Genome Research 27: 157-164. doi:10.1101/gr.210500.116</a>
      </ul> 
      <h2>お問い合わせ</h2>
〒305-8518<br>
茨城県つくば市観音台2-1-2<br>
農研機構作物研究部門<br>
宮尾安藝雄 (miyao@affrc.go.jp)<br>
    </body>
</html>