<html>
  <head>
    <meta charset = "utf-8">
    <link rel = "stylesheet" href = "../default.css">
  <head>
    <body>
      <h1>PEDを用いたミヤコグサの多型解析例</h1>
      <a href = "../index_ja.html">[日本語トップページへのリンク]</a><br><br>
      <b>ここでは、Miyakojima MG-20の多型の検出を例に、Linux(Ubuntu)のインストール、PEDのセットアップ、ゲノムブラウザでの結果の表示の方法を紹介します。</b><br><br>
      <table>
      <tr><td><a href = "gifu.png" target = "_blank"><img src = "gifu.png" height = "20%"></a></td><td><ul><li>図をクリックすると拡大されます。
<li>SNP以外に、挿入・欠失変異も正確に検出できる特徴があります。
<li>変異部分を増幅するプライマー対の配列も得られます。</ul></td></tr>
      </table>

      <h2>Ubuntuのインストール</h2>
      <ul>
      <li><a href = "https://www.ubuntulinux.jp/download/ja-remix" target = "_blank">Ubuntu Desktop 日本語 Remix</a>より日本語版のISOイメージのファイルをダウンロードします。
      <li><a href = "https://linuxfan.info/ubuntu-20-04-install-guide" target = "_blank">Ubuntu 20.04 LTSインストールガイド【スクリーンショットつき解説】</a>が詳しいので参考にしてインストールしてください。<br>
      PEDは解析時間をできるだけ短くするため、CPUの限界近くまで負荷がかかりますのでほかのOSとの共存は避けた方がいいです。<br>
使わなくなった古いコンピュータなどにインストールして専用にするのがお勧めです。<br>
マルチスレッドで動作しますので、4あるいは8コアのCPUを用いると早く処理できます。
      </ul>
      <h2>PEDのセットアップと解析例</h2>
      <ul>
      <li>必要なソフトをダウンロードとインストールを行います。
      <pre>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install curl
$ sudo apt install git
$ sudo apt install sra-toolkit
$ git clone https://github.com/akiomiyao/ped.git</pre>
      <li>Ubuntuのバージョンによっては、sra-toolkitのインストールに失敗することがあります。<br>
また最近のバージョンのfastq-dumpは使用前にvdb-configコマンドで実行環境を設定する必要があります。<br>
設定方法は、<a href = "../sratoolkit/index_ja.html" target = "_blank">[fastq-dumpの設定]</a>のページに記載しました。
      <li>NCBIのSRAアーカイブから<a href = "https://www.ncbi.nlm.nih.gov/bioproject/508312" target = "_blank">Miyakojima MG-20</a>のfastq形式のファイル(DRR066832)をダウンロードします。
      <pre>$ cd ped
$ git pull
$ perl download.pl accession=DRR066832</pre>
git pullで最新のスクリプトに更新されます。git pullは毎回行う必要はありませんが、プログラムが更新されている場合はpullしてください。<br>
pedのディレクトリの中に、DRR066832の名称のディレクトリができて、その中のreadというディレクトリの中にfastqファイルがダウンロードされます。<br>
アメリカからのダウンロードなので時間がかかります。<br>
時々エラーが表示されますが自動的に再接続されるので、気長に待ちます。<br>
同様の構造の任意の名前のディレクトリを作れば手持ちのデータの解析ができます。<br>
      <li>DRR066832の配列をミヤコグサの参照配列gifu1.2にマップして多型を検出します。
<pre>$ perl ped.pl target=DRR066832,ref=Gifu1.2</pre>
ミヤコグサの参照配列は設定済みなので自動的にダウンロードして解析用データを作成して一連の作業が自動的に進みます。<br>
解析が無事終わるとDRR066832のディレクトリの中に、DRR066832.vcfという結果をまとめたファイルができます。<br>
各座位に対してプライマーが作成可能な場合は、プライマーペアの配列データも出力されます。
      </ul>
      <h2>Dockerでの解析</h2>
      <ul>
      <li>Dockerを用いれば、必要な時に設定済み実行環境を取り込んで解析できます。<br>
      グーグルクラウド(GCP)やアマゾンウェブサービス(AWS)などのクラウドでの実行も可能です。
      <li>Dockerのセットアップ<br>
      $ sudo apt install docker<br>
      $ sudo apt install docker.io<br>
      <li>解析例<br>
      $ sudo docker pull akiomiyao/ped<br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl download.pl accession=DRR066832,wd=/work <br>
      $ sudo docker run -w /ped -v `pwd`:/work akiomiyao/ped perl ped.pl target=DRR066832,ref=Gifu1.2,wd=/work <br>
      上記のコマンドをコピーしてターミナルウインドウにペーストして実行してください。<br>
      </ul>
      <h2>IVGブラウザによる結果の確認</h2>
      <ul>
      <li>Integrative Genomics Viewer (IVG) はBroad Instituteで作成されたゲノムブラウザです。<br>
<a href = "http://software.broadinstitute.org/software/igv/download" target = "_blank">http://software.broadinstitute.org/software/igv/download</a> からダウンロードできます。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/Gifu1.2.fasta" target = "_blank">Gifu1.2.fasta</a>をクリックしてダウンロードします。<br>
IVGを開いてGenomesのプルダウンメニューよりLoad Genome from Fileを選んで、gifu1.2.fastaをロードします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/Gifu1.2.gff" target = "_blank">Gifu1.2.gff</a>
をクリックしてダウンロードして、メインの表示ボックスの下のサブのボックスにドラッグします。<br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/DRR066832.vcf" target = "_blank">DRR066832.vcf(クリックしてダウンロードできます)</a><br>
をメインの表示ボックスにドラッグすれば、Miyakojima MG-20の多型データが取り込まれます。<br>
各染色体の番号をクリックすると、染色体ごとの多型情報が表示されます。<br>
興味のある部分をクリックすると、どんどん拡大されます。<br>
多型をマウスで指すと詳細情報が表示されます。<br>
多型の種類や多型頻度、また、プライマー対の配列情報と増幅産物のサイズも表示されます。<br>
ページのトップの<a href = "gifu.png" target = "_blank">画像</a>が表示例です。<br>
多型の部分を増幅するプライマー配列も表示されます。至適配列が見つからない部位では表示されません。
      </ul>
      <h2>解析事例</h2>
<ul>
<li><a href = "https://www.nature.com/articles/s41467-018-02831-x" target = "_blank">A NIN-LIKE PROTEIN mediates nitrate-induced control of root nodule symbiosis in  <i>Lotus japonicus</i> | Nature Communications</a><br>
ミヤコグサは、マメ科の植物で、根粒菌の共生に関する遺伝子の解析が進められています。根粒菌との共生は土中の窒素源が多い場合は抑制されますが、窒素源の量に関わらず共生が行われる変異体から原因遺伝子を特定した論文です。
<li><a href = "https://trace.ncbi.nlm.nih.gov/Traces/sra/?study=DRP004033" target = "_blank">Identification of the causative gene of <i>Lotus japonicus</i> nitrate unresponsive symbiosis 1 mutants</a><br>
に、コントロールとして野生型のMG-20の配列と、変異体のnrsym1-1とnrsym1-2のNGS配列が公開されています。<br>
<li>コントロールにMG-20が用いられているので、リファレンスゲノム配列には、GifuではなくMG-20(LJ3)を使用します。<br>
<a href = "https://lotus.au.dk/data/download" target = "_blank">https://lotus.au.dk/data/download</a>より、<i>Lotus japonicus</i> MG20 v3.0 GenomeにあるLotusjaponicus_MG20_v3.0_genome.fa.gzをダウンロードします。
<pre>$ cd ped
$ mkdir LJ3
$ mv Lotusjaponicus_MG20_v3.0_genome.fa.gz LJ3
$ cd LJ3
$ gzip -d Lotusjaponicus_MG20_v3.0_genome.fa.gz</pre>
として、圧縮状態のgzファイルをfastaファイルに変換します。<br>
また、同時にMG-20のgffファイル Lotusjaponicus_MG20_v3.0_annotations.gff3.gz もダウンロードしておきます。
<li>ショートリード配列をダウンロードします。DDBJのDRAに登録されているので、<a href = "https://ddbj.nig.ac.jp/DRASearch/" target = "_blank">https://ddbj.nig.ac.jp/DRASearch/</a>を開いて、<br>
DRR097247 DRR0972478 DRR097249 DRR097250 DRR097251 DRR097252<br> 
を1つずつ順にAccessionにペーストしてSearchをクリックします。<br>
検索結果のページの2行目のFASTQのリンクをクリックすると圧縮されたショートリード配列のペアがダウンロードできます。<br>
<pre>$ mkdir MG-20
$ mkdir MG-20/read
$ mkdir nrsym1-1
$ mkdir nrsym1-1/read
$ mkdir nrsym1-2
$ mkdir nrsym1-2/read </pre>
として、それぞれコントロールとターゲットのディレクトリを作ります。<br>
<pre>$ mv DRR097247_?.fastq.bz2 DRR097248_?.fastq.bz2 MG-20/read
$ mv DRR097249_?.fastq.bz2 DRR097250_?.fastq.bz2 nrsym1-1/read
$ mv DRR097251_?.fastq.bz2 DRR097252_?.fastq.bz2 nrsym1-2/read
</pre>
として、ダウンロードしたファイルを、それぞれのディレクトリに移します。
<li>PEDでの多型検出は、<br>
<pre>$ perl ped.pl target=nrsym1-1,control=MG-20,ref=LJ3
$ perl ped.pl target=nrsym1-2,control=MG-20,ref=LJ3</pre>
で、それぞれの多型が検出されます。
<li><a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/LJ3.fasta">LJ3.fasta</a><br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/LJ3.fasta.fai">LJ3.fasta.fai</a><br>
<a href = "https://tos.nias.affrc.go.jp/~miyao/pub/20200521LJGF/Lotusjaponicus_MG20_v3.0_annotations.gff3.gz">Lotusjaponicus_MG20_v3.0_annotations.gff3.gz</a><br>
を、それぞれダウンロードします。
<li>解析済みvcfファイルは、<br>
<a href = "nrsym1-1.vcf">nrsym1-1.vcf</a><br> 
<a href = "nrsym1-2.vcf">nrsym1-2.vcf</a><br>
からダウンロードできます。
<li><a href = "https://igv.org/app/" target = "_blank">https://igv.org/app/</a>をクリックして、WebのIGVを開きます。<br>
Genomeのプルダウンメニューより、'Local File ...'を選んでダウンロードした、LJ3.fastaとLJ3.fasta.faiを両方一緒に選択してSubmitボタンをクリックします。<br>
Tracksのプルダウンメニューより、'Local File ...'を選んで、Lotusjaponicus_MG20_v3.0_annotations.gff3.gz、nrsym1-1.vcf、nrsym1-2.vcfを順にアップロードします。<br>
第5染色体を選んで、28.1MBのあたりを拡大します。<br>
Lj5g3v1999250.2の遺伝子の中にあるSNPが目的の変異です。<br>
同一遺伝子のコード領域の少しずれた位置に、2つ系統でそれぞれホモ型変異が入っているので、この遺伝子が原因遺伝だろうと見当がつきます。<br>
<a href = "nrsym1-web.png" target = "_blank"><img src = "nrsym1-web.png" height = "20%"></a>
<a href = "nrsym1-1-web.png" target = "_blank"><img src = "nrsym1-1-web.png" height = "20%"></a>
<a href = "nrsym1-2-web.png" target = "_blank"><img src = "nrsym1-2-web.png" height = "20%"></a><br>
図をクリックすると大きくなります。<br>
論文に掲載されている変異は、<i>nrsym1-2</i>遺伝子の場合で、第5染色体の28,147,403の位置のCからTへの置換変異で、283番目のバリンがイソロイシンに変わっています。<br>
この変異が原因で、窒素源の多少による根粒数の増減の調節ができなくなっていると考えられるので、この遺伝子が窒素源の量による根粒数のコントロールに関与していることが推察されます。
<li><b>注意点</b> IVGでは長い欠失や転座の情報をうまく表示できない場合があるので、転座と80塩基以上の欠失に関しては、vcfファイルに出力しないように設定しています。<br>
大きな構造変異を調べたい場合は、targetのディレクトリの中に出力された、svの拡張子のついたファイルを直接ご参照ください。
</ul>

      <h2>PEDに関する資料</h2>
      <ul>
       <li>スクリプト: <a href = "https://github.com/akiomiyao/ped/" "_blank">https://github.com/akiomiyao/ped/</a>
       <li>論文: <a href = "https://doi.org/10.1186/s12859-019-2955-6" target = "_blank">Polymorphic edge detection (PED): two efficient methods of polymorphism detection from next-generation sequencing data (2019) BMC Bioinformatics 20(1):362</a>
      </ul> 
      <h2>お問い合わせ</h2>
〒305-8518<br>
茨城県つくば市観音台2-1-2<br>
農研機構次世代作物開発研究センター<br>
宮尾安藝雄 (miyao@affrc.go.jp)<br>
    </body>
</html>
